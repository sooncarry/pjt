<template>
  <div>
    <h3 class="text-2xl font-bold mb-6">📘 주식 기초 지식 카드</h3>

    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
      <router-link
        v-for="(item, index) in knowledgeList"
        :key="item.id"
        :to="{ name: 'KnowledgeDetail', params: { id: item.id } }"
        class="block"
      >
        <div class="rounded-lg overflow-hidden shadow hover:shadow-lg transition">
          <div class="relative h-48 bg-gray-200">
            <img
              :src="item.image"
              alt="stock concept"
              class="w-full h-full object-cover border border-gray-300"
              @error="e => console.error('❌ 이미지 로딩 실패:', e.target.src)"
            />
            <div class="absolute top-2 left-2 bg-black bg-opacity-60 text-white text-xs px-2 py-1 rounded">
              {{ index + 1 | twoDigits }}
            </div>
          </div>
          <div class="p-4">
            <h4 class="text-lg font-semibold mb-1">{{ item.title }}</h4>
            <p class="text-sm text-gray-600">{{ item.description }}</p>
          </div>
        </div>
      </router-link>
    </div>
  </div>
</template>

<script>
import axios from 'axios'

export default {
  name: 'StockKnowledge',
  data() {
    return {
      knowledgeList: []
    }
  },
  filters: {
    twoDigits(val) {
      return val < 9 ? `0${val}` : val
    }
  },
  mounted() {
    this.fetchKnowledgeList()
  },
  methods: {
    async fetchKnowledgeList() {
      try {
        const response = await axios.get('/api/stock/knowledge/')
        const data = response.data

        // 🔧 이미지 경로 보정 (상대 경로일 경우 절대 URL 붙이기)
        this.knowledgeList = data.map(item => {
          if (item.image && item.image.startsWith('/media/')) {
            item.image = `http://localhost:8000${item.image}`
          }
          return item
        })
        console.log('✅ 이미지 목록 불러오기 완료:', this.knowledgeList.map(i => i.image))
      } catch (error) {
        console.error('❌ 주식 지식 데이터를 불러오는 데 실패했습니다:', error)
      }
    }
  }
}
</script>

<style scoped>
</style>
